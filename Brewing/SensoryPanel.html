<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Sensory Lab | Suburban Brewing</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root { 
      --bg: #f1f5f9; 
      --card: #ffffff; 
      --text: #0f172a; 
      --accent: #0f172a; /* Professional Black/Slate */
      --highlight: #2563eb;
      --border: #e2e8f0;
    }
    
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body { 
      font-family: 'Inter', sans-serif; 
      background: var(--bg); color: var(--text); 
      padding: 20px; margin: 0; 
      max-width: 600px; margin: 0 auto;
    }

    /* HEADER */
    .header { 
      text-align: center; margin-bottom: 25px; 
      border-bottom: 2px solid var(--border);
      padding-bottom: 20px;
    }
    .header h1 { 
      font-size: 1.2rem; margin: 0; 
      text-transform: uppercase; letter-spacing: 2px;
      color: #64748b; font-weight: 800;
    }
    .header .lab-id {
      font-family: 'Roboto Mono', monospace;
      color: var(--highlight); font-weight: 700;
      font-size: 0.9rem; margin-top: 5px;
    }

    /* CARDS */
    .card { 
      background: var(--card); 
      padding: 24px; 
      border-radius: 8px; /* Sharper corners for pro look */
      box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
      margin-bottom: 20px; 
      border: 1px solid var(--border);
    }

    .card-title {
      font-size: 0.8rem; text-transform: uppercase; 
      color: #94a3b8; font-weight: 700; letter-spacing: 1px;
      margin-bottom: 15px; display: block;
    }

    /* FORM INPUTS */
    .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
    
    label { 
      display: block; font-weight: 600; font-size: 0.8rem; 
      margin-bottom: 6px; color: #475569; 
    }
    
    select, input[type="text"], input[type="number"], textarea { 
      width: 100%; padding: 12px; 
      border: 1px solid #cbd5e1; border-radius: 6px; 
      font-size: 1rem; background: #fff; appearance: none;
      font-family: 'Inter', sans-serif;
    }
    
    input[type="text"]:focus, select:focus {
      border-color: var(--highlight); outline: none; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    /* SAMPLE ID (The "Blind" Field) */
    .blind-input {
      font-family: 'Roboto Mono', monospace;
      letter-spacing: 2px;
      font-weight: 700;
      color: var(--highlight);
    }

    /* PROFESSIONAL SLIDERS */
    .slider-container { margin-bottom: 25px; }
    .slider-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px; }
    .slider-label { font-weight: 700; font-size: 0.95rem; }
    .slider-val { font-family: 'Roboto Mono', monospace; font-weight: 700; color: var(--highlight); }
    
    input[type="range"] { 
      width: 100%; height: 4px; background: #e2e8f0; 
      border-radius: 2px; outline: none; -webkit-appearance: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; width: 20px; height: 20px; 
      background: var(--text); border: 2px solid #fff; border-radius: 50%; cursor: pointer; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* OFF FLAVOR BUTTONS */
    .defect-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .defect-check { display: none; }
    .defect-label { 
      padding: 10px; background: #f8fafc; text-align: center;
      border-radius: 6px; font-size: 0.8rem; font-weight: 600;
      color: #64748b; border: 1px solid #e2e8f0; 
      cursor: pointer; transition: 0.1s;
    }
    .defect-check:checked + .defect-label { 
      background: #fee2e2; color: #b91c1c; border-color: #ef4444; 
    }

    /* SUBMIT */
    .btn-submit { 
      width: 100%; padding: 16px; 
      background: var(--highlight); color: white; 
      border: none; border-radius: 6px; 
      font-size: 1rem; font-weight: 600; 
      margin-top: 10px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;
    }
    .btn-submit:active { opacity: 0.9; }
  </style>
</head>
<body>

  <div class="header">
    <h1>Sensory Analysis</h1>
    <div class="lab-id">QC PANEL // BLIND</div>
  </div>

  <div class="card">
    <span class="card-title">Sample Identification</span>
    
    <div class="input-row">
      <div>
        <label>Taster Initials</label>
        <input type="text" id="taster" placeholder="e.g. RD" style="text-transform: uppercase;">
      </div>
      <div>
        <label>Sample ID / Code</label>
        <input type="text" id="sampleId" class="blind-input" placeholder="# ---">
      </div>
    </div>

    <div>
      <label>Product (If Known)</label>
      <select id="beerSelect">
        <option value="Blind">-- Blind Sample --</option>
        <option value="Suburban IPA">Suburban IPA</option>
        <option value="Main St. Stout">Main St. Stout</option>
        <option value="Honey Brook Helles">Honey Brook Helles</option>
        <option value="Railway Red">Railway Red</option>
        <option value="Seasonal Sour">Seasonal Sour</option>
      </select>
    </div>
  </div>

  <div class="card">
    <span class="card-title">Attribute Intensity (0-5)</span>
    <p style="font-size: 0.8rem; color: #64748b; margin-top: -10px; margin-bottom: 20px;">
      Rate intensity relative to style guidelines.
    </p>

    <div class="slider-container">
      <div class="slider-header"><span class="slider-label">Malt</span> <span id="val-malt" class="slider-val">3.0</span></div>
      <input type="range" min="0" max="5" step="0.5" value="3" oninput="updateVal('malt', this.value)">
    </div>

    <div class="slider-container">
      <div class="slider-header"><span class="slider-label">Hops (Aroma/Flavor)</span> <span id="val-hops" class="slider-val">3.0</span></div>
      <input type="range" min="0" max="5" step="0.5" value="3" oninput="updateVal('hops', this.value)">
    </div>

    <div class="slider-container">
      <div class="slider-header"><span class="slider-label">Bitterness</span> <span id="val-bitterness" class="slider-val">3.0</span></div>
      <input type="range" min="0" max="5" step="0.5" value="3" oninput="updateVal('bitterness', this.value)">
    </div>

    <div class="slider-container">
      <div class="slider-header"><span class="slider-label">Esters</span> <span id="val-esters" class="slider-val">1.0</span></div>
      <input type="range" min="0" max="5" step="0.5" value="1" oninput="updateVal('esters', this.value)">
    </div>
    
    <div class="slider-container">
      <div class="slider-header"><span class="slider-label">Body / Mouthfeel</span> <span id="val-body" class="slider-val">3.0</span></div>
      <input type="range" min="0" max="5" step="0.5" value="3" oninput="updateVal('body', this.value)">
    </div>
  </div>

  <div class="card">
    <span class="card-title">Defect Check</span>
    <div class="defect-grid">
      <input type="checkbox" id="def1" class="defect-check" value="Diacetyl"><label for="def1" class="defect-label">Diacetyl</label>
      <input type="checkbox" id="def2" class="defect-check" value="DMS"><label for="def2" class="defect-label">DMS</label>
      <input type="checkbox" id="def3" class="defect-check" value="Oxidation"><label for="def3" class="defect-label">Oxidation</label>
      <input type="checkbox" id="def4" class="defect-check" value="Acetaldehyde"><label for="def4" class="defect-label">Acetaldehyde</label>
      <input type="checkbox" id="def5" class="defect-check" value="Phenolic"><label for="def5" class="defect-label">Phenolic</label>
      <input type="checkbox" id="def6" class="defect-check" value="Isovaleric"><label for="def6" class="defect-label">Isovaleric</label>
    </div>

    <div style="margin-top: 25px; border-top: 1px solid #e2e8f0; padding-top: 20px;">
      <span class="card-title">Overall Impression</span>
      <div style="display: flex; align-items: center; justify-content: space-between;">
        <label style="margin:0;">True-to-Brand Score (1-10)</label>
        <span id="score-disp" style="font-size: 1.5rem; font-weight: 800; color: var(--highlight);">8.0</span>
      </div>
      <input type="range" min="1" max="10" step="0.1" value="8" 
             oninput="document.getElementById('score-disp').innerText=this.value" 
             style="margin-top: 10px;">
    </div>

    <div style="margin-top: 20px;">
      <label>Notes</label>
      <textarea id="notes" rows="3" placeholder="Brief sensory comments..."></textarea>
    </div>
  </div>

  <button class="btn-submit" onclick="submitSensory()">Submit Evaluation</button>

  <script>
    // ðŸ”´ UPDATE WITH YOUR NEW SENSORY BACKEND URL ðŸ”´
    const API_URL = "https://script.google.com/macros/s/AKfycbw_YOUR_NEW_ID_HERE/exec";

    function updateVal(id, val) {
      document.getElementById('val-' + id).innerText = parseFloat(val).toFixed(1);
    }

    async function submitSensory() {
      const taster = document.getElementById('taster').value;
      const sampleId = document.getElementById('sampleId').value;
      const beer = document.getElementById('beerSelect').value;

      if(!taster) {
        Swal.fire({ icon: 'error', title: 'Missing Initials', text: 'Please enter who you are.', confirmButtonColor: '#0f172a' });
        return;
      }

      // Collect Defects
      const defects = [];
      document.querySelectorAll('.defect-check:checked').forEach(c => defects.push(c.value));
      if(defects.length === 0) defects.push("None");

      // Build "Blind" Batch Name
      // If they entered a Sample ID, use that. If not, use "N/A"
      const finalBatch = sampleId ? `SAMPLE #${sampleId}` : "Standard QC";

      const payload = {
        sessionType: "Production", // Defaulting to Prod for this view
        taster: taster,
        role: "Panelist",
        beer: beer,
        batch: finalBatch,
        spikeAgent: "", // No spiking field in Blind view (Admin handles that)
        score: document.getElementById('score-disp').innerText,
        profile: {
          malt: document.getElementById('val-malt').innerText,
          hops: document.getElementById('val-hops').innerText,
          bitterness: document.getElementById('val-bitterness').innerText,
          esters: document.getElementById('val-esters').innerText,
          body: document.getElementById('val-body').innerText
        },
        offFlavors: defects,
        notes: document.getElementById('notes').value
      };

      Swal.fire({ 
        title: 'Submitting...', 
        text: 'Uploading data to QC Database',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading() 
      });

      try {
        await fetch(API_URL, {
          method: 'POST',
          body: new URLSearchParams({
            "action": "submitSensoryLog",
            "data": JSON.stringify(payload)
          })
        });

        Swal.fire({
            icon: 'success',
            title: 'Evaluation Saved',
            text: 'Ready for next sample.',
            timer: 1500,
            showConfirmButton: false
        }).then(() => {
            // Soft reset (keep taster name, clear ratings)
            document.getElementById('sampleId').value = "";
            document.getElementById('notes').value = "";
            document.querySelectorAll('.defect-check').forEach(c => c.checked = false);
            // Reset sliders to 3
            ['malt','hops','bitterness','body'].forEach(id => {
                document.getElementById('val-'+id).innerText = "3.0";
                document.querySelector(`input[oninput="updateVal('${id}', this.value)"]`).value = 3;
            });
            // Reset esters to 1
             document.getElementById('val-esters').innerText = "1.0";
             document.querySelector(`input[oninput="updateVal('esters', this.value)"]`).value = 1;
             
             window.scrollTo(0,0);
        });
        
      } catch(e) {
        Swal.fire('Error', 'Connection failed.', 'error');
      }
    }
  </script>
</body>
</html>
