<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Store Inventory | Suburban Brewing Company</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        /* Shared Styles */
        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        body { margin: 0; background: #f4f6f8; color: #1f2937; }
        .layout { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 240px; background: #1f2937; color: #fff; padding: 20px 0; }
        .sidebar h2 { margin: 0 20px 20px; font-size: 18px; }
        .nav-link { display: block; padding: 10px 20px; color: #d1d5db; text-decoration: none; }
        .nav-link.active, .nav-link:hover { background: #374151; color: #fff; }

        /* Main Content */
        .main { flex: 1; display: flex; flex-direction: column; }
        .topbar { background: #fff; border-bottom: 1px solid #e5e7eb; padding: 16px 24px; }
        .content { padding: 24px; }
        
        .category-section { background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 30px; }
        .category-title { margin-top: 0; color: #111827; border-bottom: 2px solid #2563eb; padding-bottom: 8px; display: inline-block; margin-bottom: 15px; }

        /* Table Styles */
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px; text-align: left; }
        th { background: #f9fafb; font-weight: 600; color: #4b5563; }
        
        .sub-row { padding: 8px 10px; border-bottom: 1px solid #f3f4f6; min-height: 40px; display: flex; align-items: center; }
        .sub-row:last-child { border-bottom: none; }
        
        button { padding: 6px 12px; border: none; border-radius: 4px; background: #2563eb; color: #fff; cursor: pointer; font-size: 12px; }
        button.secondary { background: #6b7280; }
    </style>
</head>
<body>

<div class="layout">
    <aside class="sidebar">
        <h2>Suburban Brewing</h2>
        <a class="nav-link" href="../sales/invoices.html">Invoices</a>
        <a class="nav-link" href="../sales/deliveries.html">Deliveries</a>
        <a class="nav-link" href="../sales/sampling.html">Sampling</a>
        <a class="nav-link" href="brewery-inventory.html">Brewery Inventory</a>
        <a class="nav-link active" href="store-inventory.html">Store Inventory</a>
        <a class="nav-link" href="../index.html">Dashboard</a>
    </aside>

    <div class="main">
        <header class="topbar">
            <h1>Store Inventory</h1>
        </header>

        <section class="content" id="inventoryContainer">
            <p>Loading Store Inventory...</p>
        </section>
    </div>
</div>

<script>
    const API_URL = "YOUR_APPS_SCRIPT_URL_HERE"; 
    let storeInventory = [];

    document.addEventListener("DOMContentLoaded", loadStoreInventory);

    async function loadStoreInventory() {
        try {
            const res = await fetch(`${API_URL}?action=getStoreInventory`);
            storeInventory = await res.json();
            renderStoreInventory();
        } catch (err) {
            console.error("Load failed", err);
            document.getElementById('inventoryContainer').innerHTML = "Error loading inventory.";
        }
    }

    function renderStoreInventory() {
        const container = document.getElementById("inventoryContainer");
        container.innerHTML = "";

        // Get unique categories (Beer, Merch, etc)
        const categories = [...new Set(storeInventory.map(item => item.category))];

        if (categories.length === 0) {
            container.innerHTML = "<p>No inventory found in the store sheet.</p>";
            return;
        }

        categories.forEach(cat => {
            const section = document.createElement('div');
            section.className = 'category-section';
            
            let tableHtml = `
                <h3 class="category-title">${cat}</h3>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 25%;">Product</th>
                            <th style="width: 20%;">Package</th>
                            <th style="width: 15%;">On Hand</th>
                            <th style="width: 15%;">Unit</th>
                            <th style="width: 25%;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>`;

            const products = storeInventory.filter(p => p.category === cat);

            products.forEach(item => {
                let pkgCol = "", qtyCol = "", unitCol = "", actionCol = "";

                item.packages.forEach(pkg => {
                    pkgCol += `<div class="sub-row">${pkg.type}</div>`;
                    qtyCol += `<div class="sub-row">${pkg.qty}</div>`;
                    unitCol += `<div class="sub-row">${pkg.unit}</div>`;
                    actionCol += `
                        <div class="sub-row">
                            <button onclick="adjustStoreQty('${item.product}', '${pkg.type}', ${pkg.qty})">Adjust</button>
                        </div>`;
                });

                tableHtml += `
                    <tr>
                        <td style="vertical-align: top; padding-top: 12px;"><strong>${item.product}</strong></td>
                        <td style="padding: 0;">${pkgCol}</td>
                        <td style="padding: 0;">${qtyCol}</td>
                        <td style="padding: 0;">${unitCol}</td>
                        <td style="padding: 0;">${actionCol}</td>
                    </tr>`;
            });

            tableHtml += `</tbody></table>`;
            section.innerHTML = tableHtml;
            container.appendChild(section);
        });
    }

    async function adjustStoreQty(product, type, currentQty) {
        const newQty = prompt(`Adjust ${product} (${type}) count:`, currentQty);
        if (newQty === null || newQty === "" || isNaN(newQty)) return;

        // Same logic as brewery adjustment, but targeting store sheet
        try {
            const res = await fetch(API_URL, {
                method: "POST",
                body: new URLSearchParams({
                    action: "updateStoreQty",
                    product: product,
                    type: type,
                    newQty: newQty
                })
            });
            const data = await res.json();
            if (data.success) loadStoreInventory();
        } catch (err) {
            alert("Update failed.");
        }
    }
</script>
</body>
</html>
