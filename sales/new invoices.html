<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Suburban Brewing Co. | New Invoice</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root {
  --bg:#f4f6f8; --sidebar:#1f2937; --accent:#2563eb; --text:#1f2937;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}
body{margin:0;background:var(--bg);display:flex;min-height:100vh;color:var(--text)}

/* ===== SIDEBAR ===== */
.sidebar{width:240px;background:var(--sidebar);color:#fff;padding:20px 0;position:fixed;height:100vh}
.sidebar h2{margin:0 20px 20px;font-size:18px}
.nav-section-title{font-size:11px;text-transform:uppercase;opacity:.5;margin:20px 20px 8px;font-weight:700}
.nav-link{display:block;padding:10px 24px;color:#d1d5db;text-decoration:none;font-size:14px}
.nav-link:hover,.nav-link.active{background:#374151;color:#fff}
.nav-link.active{border-left:4px solid var(--accent)}

/* ===== MAIN ===== */
.main{margin-left:240px;padding:30px;flex:1}
.header-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}

/* ===== INVOICE ===== */
.invoice-page{background:#fff;width:8.5in;min-height:11in;margin:0 auto;padding:.75in;box-shadow:0 6px 18px rgba(0,0,0,.08)}
.invoice-header{display:flex;gap:24px;align-items:center}
.invoice-header img{width:120px}
.invoice-company-info{font-size:13px;line-height:1.6}
.invoice-title{text-align:center;font-size:20px;font-weight:700;margin:10px 0}
.invoice-divider{height:1px;background:#9ca3af;margin:8px 0 16px}

/* ===== META ===== */
.invoice-meta-row{display:flex;justify-content:space-between;gap:24px}
.customer-search{width:100%;font-size:12px;padding:4px}
.customer-name{font-weight:700;font-size:13px}
.customer-address{font-size:12px;line-height:1.3}
.invoice-meta{text-align:right;font-size:12px}
#barcode{height:32px;margin-top:4px}

/* ===== MODAL ===== */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center}
.modal{background:#fff;padding:20px;border-radius:6px;width:420px}
.modal h3{margin-top:0}
.modal label{display:block;font-size:12px;margin-top:10px}
.modal input,.modal select{width:100%;padding:6px;font-size:12px}
.modal-actions{text-align:right;margin-top:15px}
button{padding:6px 12px;font-size:12px;cursor:pointer}
</style>
</head>

<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <h2>SUBURBAN</h2>
  <div class="nav-section-title">Sales</div>
  <a class="nav-link active">New Invoice</a>
  <a class="nav-link">Invoices</a>
  <a class="nav-link">Customers</a>
</aside>

<main class="main">
<div class="header-bar">
  <h1>New Invoice</h1>
  <!-- LOCKED DATE (UI ONLY) -->
  <div id="current-date"></div>
</div>

<section class="invoice-page">

<header class="invoice-header">
  <img src="../background.jpg">
  <div class="invoice-company-info">
    <strong>Suburban Brewing Company</strong><br>
    3041 Horseshoe Pike Suite 120 &amp; 130<br>
    Honey Brook, PA 19344<br>
    Sales Rep: Remy Davis · 908-642-1019 · Remyjdavis90@gmail.com
  </div>
</header>

<div class="invoice-title">Invoice</div>
<div class="invoice-divider"></div>

<section class="invoice-meta-row">

<!-- CUSTOMER -->
<div>
  <input id="customer-search" class="customer-search" placeholder="Search customer...">
  <div id="customer-display" hidden>
    <div id="customer-name" class="customer-name"></div>
    <div id="customer-address" class="customer-address"></div>
  </div>
</div>

<!-- META -->
<div class="invoice-meta">
  <div>
    <strong>Date:</strong>
    <!-- LOCKED DATE (INVOICE RECORD) -->
    <span id="invoice-date"></span>
  </div>
  <div>
    <strong>Invoice #:</strong>
    <input id="invoice-number" style="width:80px">
  </div>
  <svg id="barcode"></svg>
</div>

</section>
</section>
</main>

<!-- NEW CUSTOMER MODAL -->
<div class="modal-overlay" id="customer-modal">
<div class="modal">
<h3>New Customer</h3>

<label>Customer Type</label>
<select id="cust-type">
  <option>Restaurant</option>
  <option>Wholesaler</option>
</select>

<label>Payment Method</label>
<select id="cust-payment">
  <option>Check</option>
  <option>Fintech</option>
</select>

<label>Name</label>
<input id="cust-name">

<label>Address</label>
<input id="cust-address">

<label>City</label>
<input id="cust-city">

<label>State</label>
<input id="cust-state">

<label>ZIP</label>
<input id="cust-zip">

<label>Phone</label>
<input id="cust-phone">

<label>Email</label>
<input id="cust-email">

<div class="modal-actions">
  <button onclick="saveCustomer()">Save</button>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<script>
const API_URL="https://script.google.com/macros/s/AKfycbzWSIh-msRqg_tqU3l2jGXlxRIgxZKE-tcVNYadAGb9jKtDV_VZuLS-6hxkMkqdaJoj/exec";
let customers=[],selectedCustomer=null;

/* ===== INIT ===== */
document.addEventListener("DOMContentLoaded",()=>{
  const today=new Date().toLocaleDateString();
  document.getElementById("current-date").textContent=today;
  document.getElementById("invoice-date").textContent=today;

  fetch(API_URL+"?action=getCustomers")
    .then(r=>r.json())
    .then(d=>customers=d||[]);
});

/* ===== CUSTOMER SEARCH ===== */
customer-search.oninput=e=>{
  const v=e.target.value.toLowerCase();
  const match=customers.find(c=>c.name.toLowerCase()===v);
  if(!match&&v.length>2){openModal(v)}
};

/* ===== MODAL ===== */
function openModal(name){
  cust-name.value=name;
  customer-modal.style.display="flex";
}

function saveCustomer(){
  const data={
    name:cust-name.value,
    address:`${cust-address.value}, ${cust-city.value}, ${cust-state.value} ${cust-zip.value}`,
    type:cust-type.value,
    payment:cust-payment.value,
    email:cust-email.value
  };

  fetch(API_URL,{method:"POST",body:JSON.stringify(data)})
    .then(()=>{customer-modal.style.display="none";location.reload()});
}
</script>

</body>
</html>
